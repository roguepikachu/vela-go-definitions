
# Test Job 1
apiVersion: batch/v1
kind: Job
metadata:
  name: test-job-1
  namespace: default
  labels:
    app: test-clean-jobs-app
    type: test-job
spec:
  ttlSecondsAfterFinished: 300
  template:
    spec:
      containers:
      - name: busybox
        image: busybox:latest
        command: ["sh", "-c", "echo 'Job 1 running' && sleep 5 && echo 'Job 1 done'"]
      restartPolicy: Never

---
# Test Job 2
apiVersion: batch/v1
kind: Job
metadata:
  name: test-job-2
  namespace: default
  labels:
    app: test-clean-jobs-app
    type: test-job
spec:
  ttlSecondsAfterFinished: 300
  template:
    spec:
      containers:
      - name: busybox
        image: busybox:latest
        command: ["sh", "-c", "echo 'Job 2 running' && sleep 5 && echo 'Job 2 done'"]
      restartPolicy: Never

---
# Workflow Application to test clean-jobs step
apiVersion: core.oam.dev/v1beta1
kind: Application
metadata:
  name: test-clean-jobs
  namespace: default
  labels:
    type: workflow
spec:
  components: []
  workflow:
    steps:

      # Clean all jobs with matching labels
      - name: cleanup-jobs
        type: clean-jobs
        properties:
          namespace: default
          labelselector:
            app: test-clean-jobs-app
